workflows:
  vite_capacitor_build:
    name: MyFocus
    environment:
      node: 20
      java: 21
      vars:
        PACKAGE_NAME: "app.accs.tofo"
    scripts:
      - |
        echo "ğŸ“¦ Installing NPM dependencies..."
        npm install

      - |
        echo "ğŸ”§ Building Vite app..."
        npm run build

      - |
        echo "â• Adding Android platform if not already added..."
        if [ ! -d "android" ]; then npx cap add android; fi

      - |
        echo "ğŸ”„ Syncing Capacitor with Android..."
        npx cap sync android

      - |
        echo "ğŸ“¥ Ensuring Gradle wrapper exists..."
        if [ ! -f "android/gradlew" ]; then
          cd android
          gradle wrapper
          cd ..
        fi

      - |
        echo "âœ… Fixing permissions for gradlew..."
        chmod +x android/gradlew

      - |
        echo "ğŸ› ï¸ Cleaning bad JVM options if set..."
        unset DEFAULT_JVM_OPTS

      - |
        echo "ğŸ—ï¸ Building APK..."
        cd android && ./gradlew assembleDebug

    artifacts:
      - android/app/build/outputs/**/*.apk
